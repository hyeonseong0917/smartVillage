<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Environment">

	<resultMap id="invironmentInfo" class="egovframework.smartVillage.usr.environment.vo.InvironmentInfoVO">
		<result property="thingModelAttributeId" column="thing_model_attribute_id" columnIndex="1"/>
		<result property="thingModelAttributeName" column="thing_model_attribute_name" columnIndex="2"/>
		<result property="thingModelAttributeType" column="thing_model_attribute_type" columnIndex="3"/>
		<result property="thingModelAttributeValue" column="thing_model_attribute_value" columnIndex="4"/>
	</resultMap>
	
	<select id="EnvironmentDAO.selectEnvironmentInfo" parameterClass="string" resultMap="invironmentInfo" >
		SELECT
			thing_model_attribute_id,
			thing_model_attribute_name,
			thing_model_attribute_type,
			thing_model_attribute_value
		FROM
			tbl_thing_attr_hist
		WHERE 
			(thing_model_attribute_id, thing_model_attribute_type, thing_model_attribute_time) in (
				SELECT
					thing_model_attribute_id,
					thing_model_attribute_type,
					max(thing_model_attribute_time)
				FROM
					tbl_thing_attr_hist
				WHERE
					thing_model_attribute_type = #attributeType#
				GROUP BY
					thing_model_attribute_id,
					thing_model_attribute_type
			)
		GROUP BY 
			thing_model_attribute_id
		ORDER BY
			thing_model_attribute_id
	</select>
</sqlMap>