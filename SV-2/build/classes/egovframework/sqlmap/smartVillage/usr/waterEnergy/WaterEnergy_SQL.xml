<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="WaterEnergy">

	<resultMap id="usageInfo" class="egovframework.smartVillage.usr.waterEnergy.vo.UsageVo">
		<result property="recentRegDate" column="recent_reg_date" columnIndex="1"/>
		<result property="recentUsage" column="recent_usage" columnIndex="2"/>
		<result property="prevRegDate" column="prev_reg_date" columnIndex="3"/>
		<result property="prevUsage" column="prev_usage" columnIndex="4"/>
	</resultMap>
	
	<resultMap id="usageChartInfo" class="egovframework.smartVillage.usr.waterEnergy.vo.UsageChartVo">
		<result property="regYear" column="reg_year" columnIndex="1"/>
		<result property="regMonth" column="reg_month" columnIndex="2"/>
		<result property="recentUsages" column="recent_usages" columnIndex="3"/>
		<result property="prevUsages" column="prev_usages" columnIndex="4"/>
	</resultMap>
	
	<resultMap id="exportChartInfo" class="egovframework.smartVillage.usr.waterEnergy.vo.ExportChartVo">
		<result property="regYear" column="reg_year" columnIndex="1"/>
		<result property="regMonth" column="reg_month" columnIndex="2"/>
		<result property="recentUsages" column="recent_usages" columnIndex="3"/>
		<result property="prevUsages" column="prev_usages" columnIndex="4"/>
		<result property="recentExports" column="recent_exports" columnIndex="5"/>
		<result property="prevExports" column="prev_exports" columnIndex="6"/>
	</resultMap>
		
	<select id="WaterEnergyDAO.selectWaterUsage" parameterClass="string" resultMap="usageInfo" >
		SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX("water_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.recent_reg_date
		        GROUP BY "reg_date" 
		        ORDER BY MAX("water_usage_month") DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX("water_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.prev_reg_date
		        GROUP BY "reg_date" 
		        ORDER BY MAX("water_usage_month") DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            "dongho",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '6 months') AND NOW()
		                    AND "dongho"='101'
		            ) AS "recent_reg_date",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '13 months' + INTERVAL '1 day') AND (DATE_TRUNC('YEAR', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 day')
		                    AND "dongho"='101'
		            ) AS "prev_reg_date"
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            "dongho" = '101'
		        GROUP BY
		            "dongho"
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy."dongho" = date_tab."dongho"
		ORDER BY "water_usage_month" DESC
		LIMIT 1;
				
		<!-- SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX(waterVolume)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.recent_reg_date
		        ORDER BY waterVolume DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX(waterVolume)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.prev_reg_date
		        ORDER BY waterVolume DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            dongho,
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE reg_date BETWEEN DATE_FORMAT(NOW() - INTERVAL 6 MONTH, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(NOW(), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'recent_reg_date',
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 13 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i')
		                    AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'prev_reg_date'
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		        GROUP BY
		            dongho
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy.dongho = date_tab.dongho
		ORDER BY waterVolume DESC
		LIMIT 1; -->
		
	</select>
	
	<select id="WaterEnergyDAO.selectElectricUsage" parameterClass="string" resultMap="usageInfo" >
		SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX("power_receive_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.recent_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("power_receive_month") DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX("power_receive_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.prev_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("power_receive_month") DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            "dongho",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '6 months') AND NOW()
		                    AND "dongho"='101'
		            ) AS "recent_reg_date",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '13 months' + INTERVAL '1 day') AND (DATE_TRUNC('YEAR', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 day')
		                    AND "dongho"='101'
		            ) AS "prev_reg_date"
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            "dongho" = '101'
		        GROUP BY
		            "dongho"
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy."dongho" = date_tab."dongho"
		ORDER BY "power_receive_month" DESC
		LIMIT 1;
				
		<!-- SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX(energy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.recent_reg_date
		        ORDER BY energy DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX(energy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.prev_reg_date
		        ORDER BY energy DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            dongho,
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE reg_date BETWEEN DATE_FORMAT(NOW() - INTERVAL 6 MONTH, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(NOW(), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'recent_reg_date',
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 13 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i')
		                    AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'prev_reg_date'
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		        GROUP BY
		            dongho
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy.dongho = date_tab.dongho
		ORDER BY energy DESC
		LIMIT 1; -->

	</select>
	
	<select id="WaterEnergyDAO.selectCoolingUsage" parameterClass="string" resultMap="usageInfo" >
		SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX("cooling_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.recent_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("cooling_usage_month") DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX("cooling_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.prev_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("cooling_usage_month") DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            "dongho",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '6 months') AND NOW()
		                    AND "dongho"='101'
		            ) AS "recent_reg_date",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '13 months' + INTERVAL '1 day') AND (DATE_TRUNC('YEAR', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 day')
		                    AND "dongho"='101'
		            ) AS "prev_reg_date"
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            "dongho" = '101'
		        GROUP BY
		            "dongho"
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy."dongho" = date_tab."dongho"
		ORDER BY "cooling_usage_month" DESC
		LIMIT 1;
		
		<!-- SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX(coolEnergy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.recent_reg_date
		        ORDER BY coolEnergy DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX(coolEnergy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.prev_reg_date
		        ORDER BY coolEnergy DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            dongho,
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE reg_date BETWEEN DATE_FORMAT(NOW() - INTERVAL 6 MONTH, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(NOW(), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'recent_reg_date',
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 13 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i')
		                    AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'prev_reg_date'
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		        GROUP BY
		            dongho
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy.dongho = date_tab.dongho
		ORDER BY coolEnergy DESC
		LIMIT 1; -->
	</select>
	
	<select id="WaterEnergyDAO.selectHeatingUsage" parameterClass="string" resultMap="usageInfo" >
		<!-- SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX(heatEnergy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.recent_reg_date
		        ORDER BY heatEnergy DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX(heatEnergy)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.prev_reg_date
		        ORDER BY heatEnergy DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            dongho,
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE reg_date BETWEEN DATE_FORMAT(NOW() - INTERVAL 6 MONTH, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(NOW(), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'recent_reg_date',
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 13 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i')
		                    AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'prev_reg_date'
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		        GROUP BY
		            dongho
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy.dongho = date_tab.dongho
		ORDER BY heatEnergy DESC
		LIMIT 1; -->
		SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX("heating_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.recent_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("heating_usage_month") DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX("heating_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.prev_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("heating_usage_month") DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            "dongho",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '6 months') AND NOW()
		                    AND "dongho"='101'
		            ) AS "recent_reg_date",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '13 months' + INTERVAL '1 day') AND (DATE_TRUNC('YEAR', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 day')
		                    AND "dongho"='101'
		            ) AS "prev_reg_date"
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            "dongho" = '101'
		        GROUP BY
		            "dongho"
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy."dongho" = date_tab."dongho"
		ORDER BY "heating_usage_month" DESC
		LIMIT 1;
		
	</select>
	
	<select id="WaterEnergyDAO.selectHotWaterUsage" parameterClass="string" resultMap="usageInfo" >
		<!-- SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX(heatVolume)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.recent_reg_date
		        ORDER BY heatVolume DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX(heatVolume)
		        FROM household_energy_msrmt_system1_copy
		        WHERE dongho = '101'
		        AND reg_date = date_tab.prev_reg_date
		        ORDER BY heatVolume DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            dongho,
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE reg_date BETWEEN DATE_FORMAT(NOW() - INTERVAL 6 MONTH, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(NOW(), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'recent_reg_date',
		            (
		                SELECT MAX(reg_date)
		                FROM household_energy_msrmt_system1_copy
		                WHERE STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 13 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i')
		                    AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR), '%Y-%m-%dT%H:%i')
		                    AND dongho='101'
		            ) AS 'prev_reg_date'
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		        GROUP BY
		            dongho
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy.dongho = date_tab.dongho
		ORDER BY heatVolume DESC
		LIMIT 1; -->
		SELECT
		    date_tab.recent_reg_date AS recent_reg_date,
		    (
		        SELECT MAX("hotwater_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.recent_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("hotwater_usage_month") DESC
		        LIMIT 1
		    ) AS recent_usage,
		    date_tab.prev_reg_date AS prev_reg_date,
		    (
		        SELECT MAX("hotwater_usage_month")
		        FROM household_energy_msrmt_system1_copy
		        WHERE "dongho" = '101'
		        AND "reg_date" = date_tab.prev_reg_date
		        GROUP BY "reg_date"
		        ORDER BY MAX("hotwater_usage_month") DESC
		        LIMIT 1
		    ) AS prev_usage
		FROM
		    household_energy_msrmt_system1_copy,
		    (
		        SELECT
		            "dongho",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '6 months') AND NOW()
		                    AND "dongho"='101'
		            ) AS "recent_reg_date",
		            (
		                SELECT MAX("reg_date")
		                FROM household_energy_msrmt_system1_copy
		                WHERE TO_TIMESTAMP("reg_date", 'YYYY-MM-DD"T"HH24:MI') BETWEEN (NOW() - INTERVAL '13 months' + INTERVAL '1 day') AND (DATE_TRUNC('YEAR', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 day')
		                    AND "dongho"='101'
		            ) AS "prev_reg_date"
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            "dongho" = '101'
		        GROUP BY
		            "dongho"
		    ) date_tab
		WHERE
		    household_energy_msrmt_system1_copy."dongho" = date_tab."dongho"
		ORDER BY "hotwater_usage_month" DESC
		LIMIT 1;
		
	</select>
	
	<select id="WaterEnergyDAO.selectWaterUsageChartData" parameterClass="string" resultMap="usageChartInfo" >
		SELECT
		    CONCAT(CAST(recent_usage.reg_year AS VARCHAR),'년') AS reg_year,
		    CONCAT(LPAD(CAST(recent_usage.reg_month AS VARCHAR), 2, '0'),'월') AS reg_month,
		    recent_usage.water_usage_month AS recent_usages,
		    prev_usage.water_usage_month AS prev_usages
		FROM
		    (
		        SELECT
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
		            MAX(water_usage_month) AS water_usage_month,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
		        GROUP BY
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            dongho
		        ORDER BY
		            reg_year DESC, reg_month DESC
		        LIMIT 6  
		    ) recent_usage,
		    (
		        SELECT
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
		            MAX(water_usage_month) AS water_usage_month,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
		        GROUP BY
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            dongho
		        ORDER BY
		            reg_year DESC, reg_month DESC  
		        LIMIT 6  
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month
		ORDER BY
		    reg_year ASC, reg_month ASC;
		
		<!-- SELECT
		    CONCAT(CAST(CAST(recent_usage.reg_year AS SIGNED) AS CHAR), '년') AS reg_year,
		    CONCAT(CAST(CAST(recent_usage.reg_month AS SIGNED) AS CHAR), '월') AS reg_month,
		    recent_usage.waterVolume AS recent_usages,
		    prev_usage.waterVolume AS prev_usages
		FROM
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(waterVolume) AS waterVolume,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW()) - INTERVAL 7 MONTH + INTERVAL 1 DAY, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) recent_usage,
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(waterVolume) AS waterVolume,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month; -->
	</select>
	
	<select id="WaterEnergyDAO.selectElectricUsageChartData" parameterClass="string" resultMap="exportChartInfo" >
	<!-- SELECT
	    CONCAT(CAST(CAST(recent_usage.reg_year AS SIGNED) AS CHAR), '년') AS reg_year,
	    CONCAT(CAST(CAST(recent_usage.reg_month AS SIGNED) AS CHAR), '월') AS reg_month,
	    recent_usage.energy AS recent_usages,
	    prev_usage.energy AS prev_usages,
	    recent_export.energyExport AS recent_exports,
	    prev_export.energyExport AS prev_exports
	FROM
	    (
	        SELECT
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
	            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
	            MAX(energy) AS energy,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW()) - INTERVAL 7 MONTH + INTERVAL 1 DAY, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
	        GROUP BY
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
	        ORDER BY
	            reg_year ASC, reg_month ASC
	    ) recent_usage,
	    (
	        SELECT
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
	            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
	            MAX(energy) AS energy,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
	        GROUP BY
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
	        ORDER BY
	            reg_year ASC, reg_month ASC
	    ) prev_usage,
	    (
	        SELECT
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
	            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
	            MAX(energyExport) AS energyExport,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
	        GROUP BY
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
	        ORDER BY
	            reg_year ASC, reg_month ASC
	    ) prev_export,
	    (
	        SELECT
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
	            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
	            MAX(energyExport) AS energyExport,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
	        GROUP BY
	            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
	        ORDER BY
	            reg_year ASC, reg_month ASC
	    ) recent_export
	WHERE
	    recent_usage.reg_month = prev_usage.reg_month
	    AND recent_export.reg_month=recent_usage.reg_month
	    AND prev_export.reg_month=recent_usage.reg_month; -->
	SELECT
	    CONCAT(CAST(recent_usage.reg_year AS VARCHAR),'년') AS reg_year,
	    CONCAT(LPAD(CAST(recent_usage.reg_month AS VARCHAR), 2, '0'),'월') AS reg_month,
	    recent_usage.power_receive_month AS recent_usages,
	    prev_usage.power_receive_month AS prev_usages,
		recent_export.power_transmission_month AS recent_exports,
	    prev_export.power_transmission_month AS prev_exports
	FROM
	    (
	    SELECT
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	        MAX(power_receive_month) AS power_receive_month,
	        dongho
	    FROM
	        household_energy_msrmt_system1_copy
	    WHERE
	        dongho = '101'
	        AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
	    GROUP BY
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        dongho
	    ORDER BY
	        reg_year DESC, reg_month DESC  
	    LIMIT 6  
		) prev_usage,
		(
	    SELECT
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	        MAX(power_receive_month) AS power_receive_month,
	        dongho
	    FROM
	        household_energy_msrmt_system1_copy
	    WHERE
	        dongho = '101'
	        AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
	    GROUP BY
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        dongho
	    ORDER BY
	        reg_year DESC, reg_month DESC 
	    LIMIT 6  
		) recent_usage,
		(
	    SELECT
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	        MAX(power_transmission_month) AS power_transmission_month,
	        dongho
	    FROM
	        household_energy_msrmt_system1_copy
	    WHERE
	        dongho = '101'
	        AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
	    GROUP BY
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        dongho
	    ORDER BY
	        reg_year DESC, reg_month DESC  
	    LIMIT 6  
		) prev_export,
		(
	    SELECT
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	        MAX(power_transmission_month) AS power_transmission_month,
	        dongho
	    FROM
	        household_energy_msrmt_system1_copy
	    WHERE
	        dongho = '101'
	        AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
	    GROUP BY
	        EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	        dongho
	    ORDER BY
	        reg_year DESC, reg_month DESC
	    LIMIT 6
		) recent_export
	WHERE
	    recent_usage.reg_month = prev_usage.reg_month AND
		recent_export.reg_month = prev_export.reg_month AND
		recent_usage.reg_month = recent_export.reg_month
	ORDER BY
	    reg_year ASC, reg_month ASC;
	
	</select>
	
	<select id="WaterEnergyDAO.selectCoolingUsageChartData" parameterClass="string" resultMap="usageChartInfo" >
		<!-- SELECT
		    CONCAT(CAST(CAST(recent_usage.reg_year AS SIGNED) AS CHAR), '년') AS reg_year,
		    CONCAT(CAST(CAST(recent_usage.reg_month AS SIGNED) AS CHAR), '월') AS reg_month,
		    recent_usage.coolEnergy AS recent_usages,
		    prev_usage.coolEnergy AS prev_usages
		FROM
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(coolEnergy) AS coolEnergy,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW()) - INTERVAL 7 MONTH + INTERVAL 1 DAY, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) recent_usage,
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(coolEnergy) AS coolEnergy,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month; -->
		SELECT
		    CONCAT(CAST(recent_usage.reg_year AS VARCHAR),'년') AS reg_year,
		    CONCAT(LPAD(CAST(recent_usage.reg_month AS VARCHAR), 2, '0'),'월') AS reg_month,
		    recent_usage.cooling_usage_month AS recent_usages,
		    prev_usage.cooling_usage_month AS prev_usages
		FROM
		    (
		        SELECT
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
		            MAX(cooling_usage_month) AS cooling_usage_month,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
		        GROUP BY
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            dongho
		        ORDER BY
		            reg_year DESC, reg_month DESC
		        LIMIT 6
		    ) recent_usage,
		    (
		        SELECT
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
		            MAX(cooling_usage_month) AS cooling_usage_month,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
		        GROUP BY
		            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
		            dongho
		        ORDER BY
		            reg_year DESC, reg_month DESC
		        LIMIT 6 
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month
		ORDER BY
		    reg_year ASC, reg_month ASC;
		
	</select>
	
	<select id="WaterEnergyDAO.selectHeatingUsageChartData" parameterClass="string" resultMap="usageChartInfo" >
		<!-- SELECT
		    CONCAT(CAST(CAST(recent_usage.reg_year AS SIGNED) AS CHAR), '년') AS reg_year,
		    CONCAT(CAST(CAST(recent_usage.reg_month AS SIGNED) AS CHAR), '월') AS reg_month,
		    recent_usage.heatEnergy AS recent_usages,
		    prev_usage.heatEnergy AS prev_usages
		FROM
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(heatEnergy) AS heatEnergy,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW()) - INTERVAL 7 MONTH + INTERVAL 1 DAY, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) recent_usage,
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(heatEnergy) AS heatEnergy,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month; -->
	SELECT
	    CONCAT(CAST(recent_usage.reg_year AS VARCHAR),'년') AS reg_year,
	    CONCAT(LPAD(CAST(recent_usage.reg_month AS VARCHAR), 2, '0'),'월') AS reg_month,
	    recent_usage.heating_usage_month AS recent_usages,
	    prev_usage.heating_usage_month AS prev_usages
	FROM
	    (
	        SELECT
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	            MAX(heating_usage_month) AS heating_usage_month,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
	        GROUP BY
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            dongho
	        ORDER BY
	            reg_year DESC, reg_month DESC
	        LIMIT 6
	    ) recent_usage,
	    (
	        SELECT
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	            MAX(heating_usage_month) AS heating_usage_month,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
	        GROUP BY
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            dongho
	        ORDER BY
	            reg_year DESC, reg_month DESC 
	        LIMIT 6  
	    ) prev_usage
	WHERE
	    recent_usage.reg_month = prev_usage.reg_month
	ORDER BY
	    reg_year ASC, reg_month ASC;
		
	</select>
	
	<select id="WaterEnergyDAO.selectHotWaterUsageChartData" parameterClass="string" resultMap="usageChartInfo" >
		<!-- SELECT
		    CONCAT(CAST(CAST(recent_usage.reg_year AS SIGNED) AS CHAR), '년') AS reg_year,
		    CONCAT(CAST(CAST(recent_usage.reg_month AS SIGNED) AS CHAR), '월') AS reg_month,
		    recent_usage.heatVolume AS recent_usages,
		    prev_usage.heatVolume AS prev_usages
		FROM
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(heatVolume) AS heatVolume,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW()) - INTERVAL 7 MONTH + INTERVAL 1 DAY, '%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW()),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) recent_usage,
		    (
		        SELECT
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_year,
		            MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')) AS reg_month,
		            MAX(heatVolume) AS heatVolume,
		            dongho
		        FROM
		            household_energy_msrmt_system1_copy
		        WHERE
		            dongho = '101'
		            AND STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i') BETWEEN DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 7 MONTH) - INTERVAL 1 YEAR + INTERVAL 1 DAY,'%Y-%m-%dT%H:%i') AND DATE_FORMAT(LAST_DAY(NOW() - INTERVAL 1 YEAR),'%Y-%m-%dT%H:%i')
		        GROUP BY
		            YEAR(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), MONTH(STR_TO_DATE(reg_date, '%Y-%m-%dT%H:%i')), dongho
		        ORDER BY
		            reg_year ASC, reg_month ASC
		    ) prev_usage
		WHERE
		    recent_usage.reg_month = prev_usage.reg_month; -->
	SELECT
	    CONCAT(CAST(recent_usage.reg_year AS VARCHAR),'년') AS reg_year,
	    CONCAT(LPAD(CAST(recent_usage.reg_month AS VARCHAR), 2, '0'),'월') AS reg_month,
	    recent_usage.hotwater_usage_month AS recent_usages,
	    prev_usage.hotwater_usage_month AS prev_usages
	FROM
	    (
	        SELECT
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	            MAX(hotwater_usage_month) AS hotwater_usage_month,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months') AND (DATE_TRUNC('MONTH', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
	        GROUP BY
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            dongho
	        ORDER BY
	            reg_year DESC, reg_month DESC
	        LIMIT 6
	    ) recent_usage,
	    (
	        SELECT
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_year,
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')) AS reg_month,
	            MAX(hotwater_usage_month) AS hotwater_usage_month,
	            dongho
	        FROM
	            household_energy_msrmt_system1_copy
	        WHERE
	            dongho = '101'
	            AND TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI') BETWEEN DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '7 months' - INTERVAL '1 year') AND (DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 year') + INTERVAL '1 month' - INTERVAL '1 day')
	        GROUP BY
	            EXTRACT(YEAR FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            EXTRACT(MONTH FROM TO_TIMESTAMP(reg_date, 'YYYY-MM-DD"T"HH24:MI')),
	            dongho
	        ORDER BY
	            reg_year DESC, reg_month DESC
	        LIMIT 6
	    ) prev_usage
	WHERE
	    recent_usage.reg_month = prev_usage.reg_month
	ORDER BY
	    reg_year ASC, reg_month ASC;
	
	</select>
</sqlMap>